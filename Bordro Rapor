USE [BORDRO]
GO

/****** Object:  View [dbo].[DST_AY_BAZLI_RAPOR_21_22_23]    Script Date: 19.02.2024 21:18:50 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO










ALTER VIEW [dbo].[DST_AY_BAZLI_RAPOR_21_22_23]
AS



SELECT * FROM (

SELECT  --- PR.LREF
'AĞUSTOS'AS AY,
'2022' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=8 AND YEAR(PR.INDATE)=2022 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=8 AND YEAR(PR.OUTDATE)=2022 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20220801') AND PR.INDATE <='20220831'
AND PNT.PERDBEG ='20220801'

--WHERE PR.LREF=317
) AS [F]








UNION ALL

SELECT * FROM (

SELECT  --- PR.LREF
'TEMMUZ'AS AY,
'2022' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=7 AND YEAR(PR.INDATE)=2022 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=7 AND YEAR(PR.OUTDATE)=2022 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20220701') AND PR.INDATE <='20220731'
AND PNT.PERDBEG ='20220701'

--WHERE PR.LREF=317
) AS [F]









UNION ALL


SELECT * FROM (

SELECT  --- PR.LREF
'HAZİRAN'AS AY,
'2022' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=6 AND YEAR(PR.INDATE)=2022 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=6 AND YEAR(PR.OUTDATE)=2022 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20220601') AND PR.INDATE <='20220630'
AND PNT.PERDBEG ='20220601'

--WHERE PR.LREF=317
) AS [F]









UNION ALL

SELECT * FROM (

SELECT  --- PR.LREF
'MAYIS'AS AY,
'2022' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=5 AND YEAR(PR.INDATE)=2022 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=5 AND YEAR(PR.OUTDATE)=2022 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20220501') AND PR.INDATE <='20220531'
AND PNT.PERDBEG ='20220501'

--WHERE PR.LREF=317
) AS [F]











UNION ALL

SELECT * FROM (

SELECT  --- PR.LREF
'NİSAN'AS AY,
'2022' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=4 AND YEAR(PR.INDATE)=2022 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=4 AND YEAR(PR.OUTDATE)=2022 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20220401') AND PR.INDATE <='20220430'
AND PNT.PERDBEG ='20220401'

--WHERE PR.LREF=317
) AS [F]










UNION ALL
SELECT * FROM (

SELECT  --- PR.LREF
'MART'AS AY,
'2022' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=3 AND YEAR(PR.INDATE)=2022 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=3 AND YEAR(PR.OUTDATE)=2022 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20220301') AND PR.INDATE <='20220331'
AND PNT.PERDBEG ='20220301'

--WHERE PR.LREF=317
) AS [F]











UNION ALL

SELECT * FROM (

SELECT  --- PR.LREF
'ŞUBAT'AS AY,
'2022' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=2 AND YEAR(PR.INDATE)=2022 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=2 AND YEAR(PR.OUTDATE)=2022 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20220201') AND PR.INDATE <='20220228'
AND PNT.PERDBEG ='20220201'

--WHERE PR.LREF=317
) AS [F]










UNION ALL

SELECT * FROM (

SELECT  --- PR.LREF
'OCAK'AS AY,
'2022' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=1 AND YEAR(PR.INDATE)=2022 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=1 AND YEAR(PR.OUTDATE)=2022 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20220101') AND PR.INDATE <='20220131'
AND PNT.PERDBEG ='20220101'

--WHERE PR.LREF=317
) AS [F]










UNION ALL

SELECT * FROM (

SELECT  --- PR.LREF
'EYLÜL'AS AY,
'2022' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=9 AND YEAR(PR.INDATE)=2022 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=9 AND YEAR(PR.OUTDATE)=2022 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20220901') AND PR.INDATE <='20220930'
AND PNT.PERDBEG ='20220901'

--WHERE PR.LREF=317
) AS [F]


UNION ALL





SELECT * FROM (

SELECT  --- PR.LREF
'EKİM'AS AY,
'2022' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=10 AND YEAR(PR.INDATE)=2022 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=10 AND YEAR(PR.OUTDATE)=2022 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20221001') AND PR.INDATE <='20221031'
AND PNT.PERDBEG ='20221001'

--WHERE PR.LREF=317
) AS [F]

UNION ALL









SELECT * FROM (

SELECT  --- PR.LREF
'KASIM'AS AY,
'2022' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=11 AND YEAR(PR.INDATE)=2022 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=11 AND YEAR(PR.OUTDATE)=2022 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20221101') AND PR.INDATE <='20221130'
AND PNT.PERDBEG ='20221101'

--WHERE PR.LREF=317
) AS [F]



UNION ALL




SELECT * FROM (

SELECT  --- PR.LREF
'ARALIK'AS AY,
'2022' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=12 AND YEAR(PR.INDATE)=2022 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=12 AND YEAR(PR.OUTDATE)=2022 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2022 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20221201') AND PR.INDATE <='20221231'
AND PNT.PERDBEG ='20221201'

--WHERE PR.LREF=317
) AS [F]



------------------2022----SON-----------------------





UNION ALL
------------------2023---------------------------

SELECT * FROM (

SELECT  --- PR.LREF
'AĞUSTOS'AS AY,
'2023' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=8 AND YEAR(PR.INDATE)=2023 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=8 AND YEAR(PR.OUTDATE)=2023 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=08 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20230801') AND PR.INDATE <='20230831'
AND PNT.PERDBEG ='20230801'

--WHERE PR.LREF=317
) AS [F]








UNION ALL

SELECT * FROM (

SELECT  --- PR.LREF
'TEMMUZ'AS AY,
'2023' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=7 AND YEAR(PR.INDATE)=2023 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=7 AND YEAR(PR.OUTDATE)=2023 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=07 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20230701') AND PR.INDATE <='20230731'
AND PNT.PERDBEG ='20230701'

--WHERE PR.LREF=317
) AS [F]









UNION ALL


SELECT * FROM (

SELECT  --- PR.LREF
'HAZİRAN'AS AY,
'2023' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=6 AND YEAR(PR.INDATE)=2023 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=6 AND YEAR(PR.OUTDATE)=2023 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=06 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20230601') AND PR.INDATE <='20230630'
AND PNT.PERDBEG ='20230601'

--WHERE PR.LREF=317
) AS [F]









UNION ALL

SELECT * FROM (

SELECT  --- PR.LREF
'MAYIS'AS AY,
'2023' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=5 AND YEAR(PR.INDATE)=2023 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=5 AND YEAR(PR.OUTDATE)=2023 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=05 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20230501') AND PR.INDATE <='20230531'
AND PNT.PERDBEG ='20230501'

--WHERE PR.LREF=317
) AS [F]











UNION ALL

SELECT * FROM (

SELECT  --- PR.LREF
'NİSAN'AS AY,
'2023' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=4 AND YEAR(PR.INDATE)=2023 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=4 AND YEAR(PR.OUTDATE)=2023 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=04 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20230401') AND PR.INDATE <='20230430'
AND PNT.PERDBEG ='20230401'

--WHERE PR.LREF=317
) AS [F]










UNION ALL
SELECT * FROM (

SELECT  --- PR.LREF
'MART'AS AY,
'2023' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=3 AND YEAR(PR.INDATE)=2023 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=3 AND YEAR(PR.OUTDATE)=2023 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=03 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20230301') AND PR.INDATE <='20230331'
AND PNT.PERDBEG ='20230301'

--WHERE PR.LREF=317
) AS [F]











UNION ALL

SELECT * FROM (

SELECT  --- PR.LREF
'ŞUBAT'AS AY,
'2023' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=2 AND YEAR(PR.INDATE)=2023 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=2 AND YEAR(PR.OUTDATE)=2023 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20230201') AND PR.INDATE <='20230228'
AND PNT.PERDBEG ='20230201'

--WHERE PR.LREF=317
) AS [F]










UNION ALL

SELECT * FROM (

SELECT  --- PR.LREF
'OCAK'AS AY,
'2023' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=1 AND YEAR(PR.INDATE)=2023 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=1 AND YEAR(PR.OUTDATE)=2023 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20230101') AND PR.INDATE <='20230131'
AND PNT.PERDBEG ='20230101'

--WHERE PR.LREF=317
) AS [F]










UNION ALL

SELECT * FROM (

SELECT  --- PR.LREF
'EYLÜL'AS AY,
'2023' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=9 AND YEAR(PR.INDATE)=2023 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=9 AND YEAR(PR.OUTDATE)=2023 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=09 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20230901') AND PR.INDATE <='20230930'
AND PNT.PERDBEG ='20230901'

--WHERE PR.LREF=317
) AS [F]


UNION ALL





SELECT * FROM (

SELECT  --- PR.LREF
'EKİM'AS AY,
'2023' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=10 AND YEAR(PR.INDATE)=2023 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=10 AND YEAR(PR.OUTDATE)=2023 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=10 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20231001') AND PR.INDATE <='20231031'
AND PNT.PERDBEG ='20231001'

--WHERE PR.LREF=317
) AS [F]

UNION ALL









SELECT * FROM (

SELECT  --- PR.LREF
'KASIM'AS AY,
'2023' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=11 AND YEAR(PR.INDATE)=2023 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=11 AND YEAR(PR.OUTDATE)=2023 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=11 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20231101') AND PR.INDATE <='20231130'
AND PNT.PERDBEG ='20231101'

--WHERE PR.LREF=317
) AS [F]



UNION ALL




SELECT * FROM (

SELECT  --- PR.LREF
'ARALIK'AS AY,
'2023' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=12 AND YEAR(PR.INDATE)=2023 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=12 AND YEAR(PR.OUTDATE)=2023 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=12 AND YEAR(PERDBEG)=2023 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20231201') AND PR.INDATE <='20231231'
AND PNT.PERDBEG ='20231201'

--WHERE PR.LREF=317
) AS [F]


UNION ALL




SELECT * FROM (

SELECT  --- PR.LREF
'OCAK'AS AY,
'2024' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=01 AND YEAR(PR.INDATE)=2024 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=01 AND YEAR(PR.OUTDATE)=2024 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=01 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20240101') AND PR.INDATE <='20240131'
AND PNT.PERDBEG ='20240101'

--WHERE PR.LREF=317
) AS [F]


UNION ALL




SELECT * FROM (

SELECT  --- PR.LREF
'ŞUBAT'AS AY,
'2024' AS YIL

,(SELECT FRM.NAME FROM L_CAPIFIRM FRM WHERE FRM.NR=PR.FIRMNR) [KurumAdi]
,(SELECT BLM.NAME FROM L_CAPIDEPT BLM WHERE BLM.NR=PR.DEPTNR AND BLM.FIRMNR=PR.FIRMNR) [Bolum]
,(SELECT ISY.NAME FROM L_CAPIDIV ISY WHERE ISY.FIRMNR=PR.FIRMNR AND PR.LOCNR=ISY.NR) [Isyeri]
,(SELECT BRM.NAME FROM L_CAPIUNIT BRM WHERE BRM.FIRMNR=PR.FIRMNR AND BRM.NR=PR.UNITNR) [Birim]
,CASE PE.SSKSTATUS
WHEN  1 THEN 'Normal'
WHEN  2 THEN 'Emekli'
WHEN  4 THEN 'Stajyer'
end  as SSK
,PE.SSKSTATUS

,SSKNO [SGKNo],TTFNO [TCKimlikNo],CODE [SiciNo],NAME+' '+SURNAME [AdiSoyadi] 
,PR.INDATE [GirisTarihi]
,PR.OUTDATE[CikisTarihi]
--------------
,CODE [SicilNoSAY]
,CASE WHEN MONTH(PR.INDATE)=02 AND YEAR(PR.INDATE)=2024 THEN 1 ELSE '0'END AS [İŞE GİRİŞ AY]
,CASE WHEN MONTH(PR.OUTDATE)=02 AND YEAR(PR.OUTDATE)=2024 THEN 1 ELSE '0'END AS [İŞTEN ÇIKIŞ AY]


-----------



,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)) [SGK Gun]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (1)) [Normal]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (2)) [Hafta]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (3)) [Resmi]
,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7)) [Yillik]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (7))>0
THEN 1 ELSE '' END
[YillikSAY]

,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4)) [Ucretli]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (4))>0
THEN 1 ELSE '' END  [UcretliSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9)) [Rapor]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (9))>0

THEN 1 ELSE '' END[RaporSAY]





,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) [Devamsızlık]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (8)) >0

THEN 1 ELSE '' END [DevamsızlıkSAY]


,(select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6)) [Ucretsiz Izin]

,CASE WHEN (select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=1 AND NR IN (6))>0

THEN 1 ELSE '' END [Ucretsiz IzinSAY]


--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes.Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (1)) [Faz. Mes. Odemesi]
--,(select PL.HOUR_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resm Tatil Saat]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=2 AND NR IN (3)) [Resmi Tatil Odemesi]
--,((select TOP 1(PL.NETAM) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10))) [Avans]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (1)) [İkramiye]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (8)) [İnternet Yardimi]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (9)) [Ramak Kala]


--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (12)),0) +
-- ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (10)),0) [Performans_Primi]


--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (7)) [İzin Ücreti]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (1)) [Ek Kesinti-1]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (3)) [Masraf]
--,(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) [BES]


--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (2))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (11)) [Taksitli Borc]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (12))+(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (7))+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (10) AND TRTYPE=3),0) [Icra]

--,ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [Brüt]
--,ISNULL((SELECT BALN_NETWAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [Odenecek]




--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)) [SSK Isci]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isci]
--,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )AS [Toplam İşçi Payı]
--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isci Issizlik]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) [SSK Isveren]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)) [SGDP Isveren]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0) AS [Toplam İşveren Payı]
--,(select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)) [SSK Isveren Issizlik]


--,ISNULL((SELECT BALN_MWTAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [Asgari ücret Kümülatif Matrahı]
--,ISNULL((SELECT BALN_MWTAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [Asgari ücret Matrahı]
--,ISNULL((SELECT BALN_TAXNBASE_YTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [Kum.GV Matrah]
--,ISNULL((SELECT BALN_TAXNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [GV Matrah]

--,ISNULL((SELECT BALN_PNTCALCTAXNORM FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [Gelir Vergisi]
--,ISNULL((SELECT BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [GV Istisnasi]
--,ISNULL((SELECT BALN_PNTCALCTAXNORM-BALN_MWTAXDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [Odenecek GV]

--,(select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (61)) [Damga Vergisi]
--,ISNULL((SELECT BALN_MWSTAMPDISC_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [DV Istisnasi]
--,ISNULL((SELECT BALN_STAMP FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [Odenecek Damga Vergisi]







--,(SELECT PF.BRANCHCODE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Sube Kodu]
--,(SELECT PF.BANKNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesap No]
--,(SELECT PF.IBANNO FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [IBAN]
--,(SELECT PF.WAGE_WAGE FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Tutar]
,(SELECT case when PF.WAGE_CLCTYPE=2 then 'Brüt' else 'Net' END [H] FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Hesaplama Sekli]
,(SELECT CASE WHEN PF.WAGE_OPTYPE=1 THEN 'Ay' when PF.WAGE_OPTYPE=2 then 'Gün' else 'Saat' END  FROM LH_001_PERFIN PF WHERE PF.PERREF=PR.LREF) [Odeme Tipi]
--,ISNULL((SELECT WAGE_WAGE FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) [Puantaj Maaş]
--,ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0) [Günlük Brüt]


,CASE  WHEN ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)=0 THEN 'DİĞER ÜCRETLİ' 
 when ISNULL (ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) / NULLIF((select PL.DAY_ from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=0 AND NR IN (1)),0),0)<=215.7 THEN  'ASGARİ ÜCRETLİ' 
 else 'DİĞER ÜCRETLİ' END 'ÜCRET TİPİ'
--,CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END [Katkı Payının Matraha Oranı (%)]
--,(ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100 AS [BES HESAPLAMA]


--,CASE WHEN (select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9))=0 THEN 0 ELSE
--(select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=5 AND NR IN (9)) -((ISNULL((SELECT BALN_SSKNBASE_PTD FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF),0) *CASE WHEN ISNULL(DEFN.NUMFLDS1,0)=0 THEN 3 ELSE ISNULL(DEFN.NUMFLDS1,0)END)/100) END AS [BES KONTROL]

-- ,ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (4,7)),0)+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0 )+ISNULL((select ROUND(SUM(PL.NETAM),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0)AS [TOPLAM İŞÇİ+İŞSİZLİK]
--,ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (0,4,7)) ,0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (5)),0)+ISNULL((select ROUND(SUM(PL.TAXEXCL),2) from LH_001_PNTLINE PL where PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=6 AND NR IN (6)),0) AS [TOPLAM İŞVEREN+İŞSİZLİK]

--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (13)),0) [Devam Primi]
--,ISNULL((select PL.NETAM from LH_001_PNTLINE PL where   PL.PREF=(SELECT LREF FROM LH_001_PNTCARD PNT WHERE MONTH(PERDBEG)=02 AND YEAR(PERDBEG)=2024 and PNT.PERREF=PR.LREF) AND PL.TYP=4 AND NR IN (16)),0) [İşe Giriş Muayene Ücreti]
FROM LH_001_PERSON PR
LEFT JOIN  LH_001_DEFNFLDSCARDV DEFN ON PR.LREF=DEFN.PARENTREF
LEFT JOIN LH_001_PERFIN PE ON PE.PERREF=PR.LREF
LEFT JOIN LH_001_PNTCARD PNT ON PR.LREF=PNT.PERREF
WHERE  (PR.OUTDATE IS NULL OR  PR.OUTDATE >='20240201') AND PR.INDATE <='20240229'
AND PNT.PERDBEG ='20240201'

--WHERE PR.LREF=317
) AS [F]




GO
